<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            /* Theme Colors */
            --primary: #3B82F6;
            --primary-dark: #2563EB;
            --primary-light: rgba(59, 130, 246, 0.1);
            --primary-glow: rgba(59, 130, 246, 0.3);
            
            --secondary: #10B981;
            --secondary-light: rgba(16, 185, 129, 0.1);
            --secondary-glow: rgba(16, 185, 129, 0.3);
            
            --warning: #F59E0B;
            --warning-light: rgba(245, 158, 11, 0.1);
            --warning-glow: rgba(245, 158, 11, 0.3);
            
            --danger: #EF4444;
            --danger-light: rgba(239, 68, 68, 0.1);
            --danger-glow: rgba(239, 68, 68, 0.3);
            
            --info: #8B5CF6;
            --info-light: rgba(139, 92, 246, 0.1);
            
            /* Dark Theme - Default */
            --bg-primary: #0F172A;
            --bg-secondary: #1E293B;
            --bg-tertiary: #334155;
            --bg-card: #1E293B;
            --bg-hover: #334155;
            
            --text-primary: #F1F5F9;
            --text-secondary: #CBD5E1;
            --text-light: #94A3B8;
            --text-muted: #64748B;
            
            --border: rgba(148, 163, 184, 0.1);
            --border-light: rgba(148, 163, 184, 0.05);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.5);
            --shadow-glow: 0 0 20px rgba(59, 130, 246, 0.3);
            
            /* Layout */
            --sidebar-width: 280px;
            --header-height: 70px;
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
        }

        /* Light Theme */
        body.light-mode {
            --bg-primary: #F8FAFC;
            --bg-secondary: #FFFFFF;
            --bg-tertiary: #F1F5F9;
            --bg-card: #FFFFFF;
            --bg-hover: #F1F5F9;
            
            --text-primary: #1E293B;
            --text-secondary: #334155;
            --text-light: #475569;
            --text-muted: #64748B;
            
            --border: rgba(15, 23, 42, 0.15);
            --border-light: rgba(15, 23, 42, 0.08);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1);
            --shadow-glow: 0 0 20px rgba(59, 130, 246, 0.2);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            direction: rtl;
            overflow-x: hidden;
            min-height: 100vh;
            transition: all 0.3s ease;
        }

        /* Force text colors in light mode */
        body.light-mode * {
            color: inherit;
        }

        body.light-mode .header h1,
        body.light-mode .section-header h2,
        body.light-mode .modal-header h3,
        body.light-mode .form-group label,
        body.light-mode .financial-card h3,
        body.light-mode .balance-card h3,
        body.light-mode .users-table th {
            color: #1E293B !important;
        }

        body.light-mode .stat-card p,
        body.light-mode .financial-card p,
        body.light-mode .user-info span,
        body.light-mode .users-table td {
            color: #334155 !important;
        }

        body.light-mode .balance-card .amount,
        body.light-mode .users-table tbody tr {
            color: #1E293B !important;
        }

        /* ============ Header ============ */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            color: var(--text-primary);
            padding: 20px 30px;
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--info));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info span {
            color: var(--text-secondary);
            font-weight: 500;
        }

        .logout-btn {
            background: var(--primary-light);
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 10px 20px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .logout-btn:hover {
            background: var(--primary);
            color: white;
            box-shadow: var(--shadow-glow);
            transform: translateY(-2px);
        }

        /* ============ Container ============ */
        .container {
            padding: 30px;
            max-width: 1600px;
            margin: 0 auto;
            padding-bottom: 100px;
        }

        .content-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 30px;
            box-shadow: var(--shadow-md);
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }

        .content-section:hover {
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-glow);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
            gap: 15px;
        }

        .section-header h2 {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-header h2 i {
            color: var(--primary);
            font-size: 1.3rem;
        }

        /* ============ Stats Grid ============ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
            border: 1px solid var(--border);
            padding: 25px;
            border-radius: var(--radius-md);
            text-align: center;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--info));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-card h3 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--info));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-card p {
            font-size: 0.95rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .stat-card.financial h3 { 
            background: linear-gradient(135deg, var(--secondary), #059669);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .stat-card.warning h3 { 
            background: linear-gradient(135deg, var(--warning), #d97706);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .stat-card.danger h3 { 
            background: linear-gradient(135deg, var(--danger), #dc2626);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .stat-card.info h3 { 
            background: linear-gradient(135deg, var(--info), #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* ============ Financial Summary ============ */
        .financial-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .financial-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: 30px;
            box-shadow: var(--shadow-md);
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .financial-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: var(--primary);
            transition: width 0.3s ease;
        }

        .financial-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .financial-card:hover::after {
            width: 100%;
            opacity: 0.1;
        }

        .financial-card h3 {
            margin-bottom: 20px;
            color: var(--text-primary);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: 600;
        }

        .financial-card .amount {
            font-size: 2.2rem;
            font-weight: 800;
            margin: 15px 0;
        }

        .financial-card .amount.paid { color: var(--secondary); }
        .financial-card .amount.remaining { color: var(--danger); }
        .financial-card .amount.total { color: var(--primary); }

        .financial-card p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* ============ Users Table ============ */
        .users-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-input,
        .role-filter {
            padding: 14px 18px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 0.95rem;
            background: var(--bg-secondary);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .search-input:focus,
        .role-filter:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light);
            background: var(--bg-tertiary);
        }

        .search-input {
            flex: 1;
            min-width: 250px;
        }

        .role-filter {
            min-width: 180px;
        }

        .users-table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border-radius: var(--radius-md);
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
        }

        .users-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-secondary);
        }

        .users-table th,
        .users-table td {
            padding: 18px;
            text-align: right;
            border-bottom: 1px solid var(--border);
        }

        .users-table th {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.95rem;
            position: sticky;
            top: 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .users-table tbody tr {
            transition: all 0.2s ease;
        }

        .users-table tbody tr:hover {
            background: var(--bg-hover);
            transform: scale(1.01);
        }

        .user-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 10px 18px;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
            font-weight: 500;
            white-space: nowrap;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .edit-btn {
            background: var(--primary-light);
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        .edit-btn:hover {
            background: var(--primary);
            color: white;
        }

        .delete-btn {
            background: var(--danger-light);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .delete-btn:hover {
            background: var(--danger);
            color: white;
        }

        .add-user-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 600;
            white-space: nowrap;
            box-shadow: var(--shadow-sm);
        }

        .add-user-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-glow);
        }

        /* ============ Modal ============ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 35px;
            border-radius: var(--radius-lg);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .modal-header h3 {
            font-size: 1.4rem;
            color: var(--text-primary);
            font-weight: 700;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-btn:hover {
            color: var(--danger);
            background: var(--danger-light);
            transform: rotate(90deg);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 0.95rem;
            transition: all 0.3s ease;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light);
            background: var(--bg-tertiary);
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 30px;
        }

        .submit-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .submit-btn:hover {
            background: var(--primary-dark);
            box-shadow: var(--shadow-glow);
            transform: translateY(-2px);
        }

        .cancel-btn {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
            padding: 14px 28px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .cancel-btn:hover {
            background: var(--bg-hover);
            border-color: var(--text-muted);
        }

        .status-message {
            padding: 16px;
            border-radius: var(--radius-sm);
            margin-top: 20px;
            display: none;
            font-weight: 500;
            border: 1px solid;
        }

        .status-message.success {
            background: var(--secondary-light);
            color: var(--secondary);
            border-color: var(--secondary);
        }

        .status-message.error {
            background: var(--danger-light);
            color: var(--danger);
            border-color: var(--danger);
        }

        .status-message.info {
            background: var(--primary-light);
            color: var(--primary);
            border-color: var(--primary);
        }

        /* ============ Tab Navigation ============ */
        .tab-navigation {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            box-shadow: 0 -4px 15px rgba(0, 0, 0, 0.3);
            z-index: 200;
            padding: 8px 0 max(8px, env(safe-area-inset-bottom));
            backdrop-filter: blur(10px);
        }

        .tab-btn {
            flex: 1;
            background: none;
            border: none;
            color: var(--text-muted);
            padding: 10px 8px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            font-size: 0.7rem;
            transition: all 0.3s ease;
            font-weight: 600;
            position: relative;
            min-height: 60px;
        }

        .tab-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 3px;
            background: var(--primary);
            transition: width 0.3s ease;
        }

        .tab-btn:hover {
            color: var(--text-secondary);
            background: var(--bg-hover);
        }

        .tab-btn.active {
            color: var(--primary);
        }

        .tab-btn.active::before {
            width: 60%;
        }

        .tab-btn i {
            font-size: 1.5rem;
        }

        .tab-btn span {
            font-size: 0.7rem;
            white-space: nowrap;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        /* ============ Treasury ============ */
        .treasury-balance {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .balance-card {
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 30px;
            border-radius: var(--radius-md);
            text-align: center;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .balance-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--info), var(--primary));
        }

        .balance-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .balance-card h3 {
            font-size: 1rem;
            margin-bottom: 15px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .balance-card .amount {
            font-size: 2rem;
            font-weight: 800;
            color: var(--text-primary);
        }

        /* ============ No Data ============ */
        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
            font-size: 1.1rem;
        }

        .no-data i {
            font-size: 3.5rem;
            margin-bottom: 20px;
            display: block;
            opacity: 0.4;
        }

        /* ============ Loading Spinner ============ */
        .loading-spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid var(--border);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ============ Advanced Search Button ============ */
        .advanced-search-btn {
            background: var(--info-light);
            color: var(--info);
            border: 1px solid var(--info);
            padding: 14px 18px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .advanced-search-btn:hover {
            background: var(--info);
            color: white;
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
        }

        /* ============ Backup & Export Buttons ============ */
        .backup-btn, .export-btn {
            border: none;
            padding: 14px 24px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 600;
            margin-top: 25px;
        }

        .backup-btn {
            background: var(--warning);
            color: white;
        }

        .backup-btn:hover {
            background: #d97706;
            transform: translateY(-2px);
            box-shadow: 0 0 20px var(--warning-glow);
        }

        .export-btn {
            background: var(--secondary);
            color: white;
        }

        .export-btn:hover {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: 0 0 20px var(--secondary-glow);
        }

        /* ============ Responsive ============ */
        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
                padding-bottom: 100px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .stat-card {
                padding: 20px;
            }

            .stat-card h3 {
                font-size: 2rem;
            }

            .financial-summary {
                grid-template-columns: 1fr;
            }

            .section-header {
                flex-direction: column;
                align-items: stretch;
            }

            .add-user-btn {
                width: 100%;
                justify-content: center;
            }

            .users-filters {
                flex-direction: column;
            }

            .search-input,
            .role-filter {
                width: 100%;
            }

            .users-table th,
            .users-table td {
                padding: 12px 8px;
                font-size: 0.85rem;
            }

            .user-actions {
                flex-direction: column;
            }

            .action-btn {
                width: 100%;
                justify-content: center;
                font-size: 0.85rem;
            }

            .header {
                padding: 15px 20px;
            }

            .header h1 {
                font-size: 1.2rem;
            }

            .tab-btn {
                min-height: 65px;
            }

            .tab-btn i {
                font-size: 1.3rem;
            }

            .tab-btn span {
                font-size: 0.65rem;
            }

            /* Extra space for last elements */
            .content-section:last-child {
                margin-bottom: 40px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px 10px;
                padding-bottom: 110px;
            }

            .stat-card h3 {
                font-size: 1.8rem;
            }

            .financial-card .amount {
                font-size: 1.8rem;
            }

            .tab-navigation {
                padding: 6px 0 max(75px, env(safe-area-inset-bottom));
            }

            .tab-btn {
                padding: 8px 5px;
                min-height: 60px;
            }

            .tab-btn i {
                font-size: 1.2rem;
            }

            .tab-btn span {
                font-size: 0.6rem;
            }

            /* Extra space for last elements */
            .content-section:last-child {
                margin-bottom: 50px;
            }
        }

        @media (max-width: 360px) {
            .container {
                padding-bottom: 120px;
            }

            .tab-btn span {
                font-size: 0.55rem;
            }

            .tab-btn i {
                font-size: 1.1rem;
            }

            /* Extra space for last elements */
            .content-section:last-child {
                margin-bottom: 60px;
            }
        }

        /* ============ Hide Actions/Transactions ============ */
        .actions-hidden .user-actions {
            display: none;
        }

        .actions-hidden .users-table th:last-child,
        .actions-hidden .users-table td:last-child {
            display: none;
        }

        .transactions-hidden .users-table {
            display: none;
        }

        /* ============ Scrollbar Styling ============ */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--bg-tertiary);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* ============ Notification Animation ============ */
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    </style>
</head>
<body>

    <!--

    <!-- Header -->
    <header class="header">
        <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</h1>
        <div class="user-info">
            <span id="userName">Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</span>
            <button class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬
            </button>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        
        <!-- Overview Tab -->
        <div id="overviewTab" class="tab-content active">
            <div class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-chart-bar"></i> Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</h2>
                </div>
                <div class="stats-grid">
                    <div class="stat-card"><h3 id="totalUsers">0</h3><p>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p></div>
                    <div class="stat-card"><h3 id="totalStudents">0</h3><p>Ø§Ù„Ø·Ù„Ø§Ø¨</p></div>
                    <div class="stat-card"><h3 id="totalCourses">0</h3><p>Ø§Ù„Ø¯ÙˆØ±Ø§Øª</p></div>
                    <div class="stat-card financial"><h3 id="totalTeachers">0</h3><p>Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</p></div>
                    <div class="stat-card info"><h3 id="totalModules">0</h3><p>Ø§Ù„ÙˆØ­Ø¯Ø§Øª</p></div>
                    <div class="stat-card warning"><h3 id="totalExams">0</h3><p>Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</p></div>
                </div>

                <div class="section-header" style="margin-top: 30px;">
                    <h2><i class="fas fa-chart-line"></i> Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h2>
                </div>
                <div class="financial-summary">
                    <div class="financial-card">
                        <h3><i class="fas fa-money-bill-wave"></i> Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</h3>
                        <div class="amount paid" id="totalPaidAmount">0 Ø¬Ù†ÙŠÙ‡</div>
                        <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©</p>
                    </div>
                    <div class="financial-card">
                        <h3><i class="fas fa-exclamation-circle"></i> Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</h3>
                        <div class="amount remaining" id="totalRemainingAmount">0 Ø¬Ù†ÙŠÙ‡</div>
                        <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©</p>
                    </div>
                    <div class="financial-card">
                        <h3><i class="fas fa-calculator"></i> Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</h3>
                        <div class="amount total" id="totalFinancialAmount">0 Ø¬Ù†ÙŠÙ‡</div>
                        <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Users Tab -->
        <div id="usersTab" class="tab-content">
            <div class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-users-cog"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h2>
                    <button class="add-user-btn" onclick="showAddUserModal()">
                        <i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
                    </button>
                </div>

                <div class="users-filters">
                    <input type="text" id="userSearchInput" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…..." class="search-input">
                    <select id="userRoleFilter" class="role-filter">
                        <option value="">ÙƒÙ„ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</option>
                        <option value="admin">Ù…Ø¯ÙŠØ±</option>
                        <option value="teacher">Ù…Ø¹Ù„Ù…</option>
                        <option value="secretary">Ø³ÙƒØ±ØªÙŠØ±</option>
                    </select>
                    <button class="action-btn" onclick="toggleActionsColumn()" style="background: var(--info); color: white;">
                        <i class="fas fa-eye-slash"></i> <span id="toggleActionsText">Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</span>
                    </button>
                    <button class="advanced-search-btn" onclick="advancedSearch()">
                        <i class="fas fa-search-plus"></i> Ø¨Ø­Ø« Ù…ØªÙ‚Ø¯Ù…
                    </button>
                </div>

                <div class="users-table-container">
                    <table class="users-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</th>
                                <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th>
                                <th>Ø§Ù„ØªØ®ØµØµ</th>
                                <th>Ø§Ù„Ø¯ÙˆØ±</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <tr><td colspan="7" class="no-data"><i class="fas fa-spinner fa-spin"></i><br>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Treasury Tab -->
        <div id="treasuryTab" class="tab-content">
            <div class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-vault"></i> Ø®Ø²ÙŠÙ†Ø© Ø§Ù„Ø³ÙƒØ±ØªØ§Ø±ÙŠØ©</h2>
                    <button class="add-user-btn" onclick="showWithdrawModal()" style="background: var(--danger);">
                        <i class="fas fa-money-bill-wave"></i> Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø®Ø²ÙŠÙ†Ø©
                    </button>
                </div>

                <div class="treasury-balance">
                    <div class="balance-card">
                        <h3><i class="fas fa-wallet"></i> Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>
                        <div class="amount" id="adminTreasuryBalance">0.00 Ø¬.Ù…</div>
                    </div>
                    <div class="balance-card" style="background: linear-gradient(135deg, #10b981, #059669);">
                        <h3><i class="fas fa-arrow-down"></i> Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª</h3>
                        <div class="amount" id="adminTreasuryDeposited">0.00 Ø¬.Ù…</div>
                    </div>
                    <div class="balance-card" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                        <h3><i class="fas fa-arrow-up"></i> Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª</h3>
                        <div class="amount" id="adminTreasuryWithdrawn">0.00 Ø¬.Ù…</div>
                    </div>
                </div>

                <div class="users-filters" style="margin-bottom: 20px;">
                    <h3 style="margin: 0; font-size: 1.1rem;">Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h3>
                    <select id="adminTreasuryFilter" onchange="filterAdminTreasuryTransactions()" class="role-filter">
                        <option value="">ÙƒÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</option>
                        <option value="deposit">Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª</option>
                        <option value="withdrawal">Ø³Ø­ÙˆØ¨Ø§Øª</option>
                    </select>
                    <button class="action-btn" onclick="toggleTransactionsTable()" style="background: var(--warning); color: white;">
                        <i class="fas fa-eye-slash"></i> <span id="toggleTransactionsText">Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø³Ø¬Ù„</span>
                    </button>
                </div>

                <div class="users-table-container">
                    <table class="users-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                <th>Ø§Ù„ÙˆØµÙ</th>
                                <th>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th>
                            </tr>
                        </thead>
                        <tbody id="adminTreasuryTransactionsBody">
                            <tr><td colspan="5" class="no-data"><i class="fas fa-spinner fa-spin"></i><br>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reportsTab" class="tab-content">
            <div class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-file-pdf"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h2>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <button class="add-user-btn" onclick="generateStudentReport()" style="background: #3b82f6;">
                        <i class="fas fa-users"></i> ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø·Ù„Ø§Ø¨
                    </button>
                    <button class="add-user-btn" onclick="generateFinancialReport()" style="background: #10b981;">
                        <i class="fas fa-money-bill-wave"></i> Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ
                    </button>
                    <button class="add-user-btn" onclick="generatePaymentReport()" style="background: #f59e0b;">
                        <i class="fas fa-credit-card"></i> ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¯ÙØ¹Ø§Øª
                    </button>
                    <button class="add-user-btn" onclick="generateAttendanceReport()" style="background: #8b5cf6;">
                        <i class="fas fa-calendar-check"></i> ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ±
                    </button>
                </div>
                <button class="export-btn" onclick="exportReportToExcel()">
                    <i class="fas fa-file-excel"></i> ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¥Ù„Ù‰ Excel
                </button>
                <div id="reportStatus" class="status-message"></div>
                <div id="reportPreview" style="margin-top: 25px;"></div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settingsTab" class="tab-content">
            <div class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-user-circle"></i> Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h2>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 25px;">
                    <div class="form-group">
                        <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                        <input type="text" id="profileFullName" readonly style="background: var(--bg-secondary);">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" id="profileEmail" readonly style="background: var(--bg-secondary);">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø¯ÙˆØ±</label>
                        <input type="text" id="profileRole" readonly style="background: var(--bg-secondary);">
                    </div>
                </div>

                <div class="section-header" style="margin-top: 40px;">
                    <h2><i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div style="border: 2px solid var(--border); padding: 25px; border-radius: var(--radius-md);">
                        <h4 style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-moon"></i> Ø§Ù„Ù…Ø¸Ù‡Ø±
                        </h4>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()" style="width: 20px; height: 20px;">
                            Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
                        </label>
                    </div>
                    <div style="border: 2px solid var(--border); padding: 25px; border-radius: var(--radius-md);">
                        <h4 style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-bell"></i> Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                        </h4>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="notificationToggle" checked onchange="toggleNotifications()" style="width: 20px; height: 20px;">
                            ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                        </label>
                    </div>
                    <div style="border: 2px solid var(--border); padding: 25px; border-radius: var(--radius-md);">
                        <h4 style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-key"></i> Ø§Ù„Ø£Ù…Ø§Ù†
                        </h4>
                        <button class="add-user-btn" onclick="showChangePasswordModal()" style="width: 100%; background: #f59e0b;">
                            <i class="fas fa-lock"></i> ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                        </button>
                    </div>
                </div>

                <div class="section-header" style="margin-top: 40px;">
                    <h2><i class="fas fa-database"></i> Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</h2>
                </div>
                <button class="backup-btn" onclick="backupDatabase()">
                    <i class="fas fa-download"></i> Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                </button>
            </div>
        </div>

    </div>

    <!-- Tab Navigation -->
    <nav class="tab-navigation">
        <button class="tab-btn active" onclick="switchTab('overviewTab')" data-tab="overviewTab">
            <i class="fas fa-chart-line"></i>
            <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
        </button>
        <button class="tab-btn" onclick="switchTab('usersTab')" data-tab="usersTab">
            <i class="fas fa-users"></i>
            <span>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
        </button>
        <button class="tab-btn" onclick="switchTab('treasuryTab')" data-tab="treasuryTab">
            <i class="fas fa-piggy-bank"></i>
            <span>Ø§Ù„Ø®Ø²ÙŠÙ†Ø©</span>
        </button>
        <button class="tab-btn" onclick="switchTab('reportsTab')" data-tab="reportsTab">
            <i class="fas fa-file-alt"></i>
            <span>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span>
        </button>
        <button class="tab-btn" onclick="switchTab('settingsTab')" data-tab="settingsTab">
            <i class="fas fa-cog"></i>
            <span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
        </button>
    </nav>

    <!-- Add User Modal -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ“ Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h3>
                <button class="close-btn" onclick="closeAddUserModal()">Ã—</button>
            </div>
            <form id="addUserForm">
                <div class="form-group">
                    <label>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                    <input type="text" id="addFullName" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
                </div>
                <div class="form-group">
                    <label>ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <input type="email" id="addEmail" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
                </div>
                <div class="form-group">
                    <label>ğŸ”’ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="addPassword" required minlength="6" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ©">
                </div>
                <div class="form-group">
                    <label>ğŸ“± Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                    <input type="tel" id="addPhone" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
                </div>
                <div class="form-group">
                    <label>ğŸ“š Ø§Ù„ØªØ®ØµØµ</label>
                    <input type="text" id="addSpecialty" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ØªØ®ØµØµ">
                </div>
                <div class="form-group">
                    <label>ğŸ‘” Ø§Ù„Ø¯ÙˆØ±</label>
                    <select id="addRole" required>
                        <option value="admin">Ù…Ø¯ÙŠØ±</option>
                        <option value="teacher">Ù…Ø¹Ù„Ù…</option>
                        <option value="secretary">Ø³ÙƒØ±ØªÙŠØ±</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="submit" class="submit-btn">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</button>
                    <button type="button" class="cancel-btn" onclick="closeAddUserModal()">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </form>
            <div id="addUserStatus" class="status-message"></div>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <div id="withdrawModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ’° Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø®Ø²ÙŠÙ†Ø©</h3>
                <button class="close-btn" onclick="closeWithdrawModal()">Ã—</button>
            </div>
            <form id="withdrawForm">
                <div class="form-group">
                    <label>ğŸ’µ Ø§Ù„Ù…Ø¨Ù„Øº (Ø¬.Ù…) *</label>
                    <input type="number" id="withdrawAmount" required min="0.01" step="0.01" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº">
                </div>
                <div class="form-group">
                    <label>ğŸ“ Ø§Ù„ÙˆØµÙ</label>
                    <textarea id="withdrawDescription" rows="3" placeholder="Ø£Ø¯Ø®Ù„ ÙˆØµÙØ§Ù‹ Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø³Ø­Ø¨"></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="submit-btn" style="background: var(--danger);">Ø³Ø­Ø¨</button>
                    <button type="button" class="cancel-btn" onclick="closeWithdrawModal()">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </form>
            <div id="withdrawStatus" class="status-message"></div>
        </div>
    </div>

    <!-- Advanced Search Modal -->
    <div id="advancedSearchModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ” Ø¨Ø­Ø« Ù…ØªÙ‚Ø¯Ù…</h3>
                <button class="close-btn" onclick="closeAdvancedSearchModal()">Ã—</button>
            </div>
            <div class="form-group">
                <label>ØªØ§Ø±ÙŠØ® Ù…Ù†:</label>
                <input type="date" id="dateFrom" class="search-input">
            </div>
            <div class="form-group">
                <label>ØªØ§Ø±ÙŠØ® Ø¥Ù„Ù‰:</label>
                <input type="date" id="dateTo" class="search-input">
            </div>
            <div class="form-group">
                <label>Ø§Ù„Ø­Ø§Ù„Ø©:</label>
                <select id="statusFilter" class="role-filter">
                    <option value="">Ø§Ù„ÙƒÙ„</option>
                    <option value="active">Ù†Ø´Ø·</option>
                    <option value="inactive">ØºÙŠØ± Ù†Ø´Ø·</option>
                </select>
            </div>
            <div class="form-actions">
                <button class="submit-btn" onclick="applyAdvancedSearch()">Ø¨Ø­Ø«</button>
                <button class="cancel-btn" onclick="closeAdvancedSearchModal()">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <script>
        // ============ Supabase Configuration ============
        const SUPABASE_URL = 'https://nhzbnzcdsebepsmrtona.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5oemJuemNkc2ViZXBzbXJ0b25hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NjU4MTEsImV4cCI6MjA3OTI0MTgxMX0.wNSf49MpQjCCopByd3zCz4-TJ2EGGABc3-ICEsAPaFo';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Set academy context
        const currentAcademyId = localStorage.getItem('current_academy_id');
        if (currentAcademyId) {
            supabase.rpc('set_academy_context', { academy_id: currentAcademyId });
        }

        // ============ Data Variables ============
        let usersData = [];
        let coursesData = [];
        let paymentsData = [];
        let studentsData = [];
        let examsData = [];
        let modulesData = [];
        let adminTreasuryData = null;
        let adminTreasuryTransactions = [];
        let actionsVisible = true;
        let transactionsVisible = true;

        // ============ Tab Navigation ============
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName)?.classList.add('active');
            document.querySelector(`[data-tab="${tabName}"]`)?.classList.add('active');
            
            localStorage.setItem('activeTab', tabName);
            
            if (tabName === 'treasuryTab') loadTreasury();
            if (tabName === 'usersTab') renderUsersTable();
            
            window.scrollTo(0, 0);
        }

        // ============ Initialize App ============
        async function initializeApp() {
            try {
                await loadAllData();
                updateStats();
                updateFinancialStats();
                renderUsersTable();
                loadAdminProfile();
                setupRealtimeNotifications();
                
                const savedTab = localStorage.getItem('activeTab') || 'overviewTab';
                switchTab(savedTab);
                
                // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ØªÙØ§Ø¹Ù„
                addHoverEffects();
            } catch (err) {
                console.error('Error initializing app:', err);
            }
        }

        // ============ Load Data ============
        async function loadAllData() {
            await Promise.all([
                loadUsers(),
                loadStudents(),
                loadCourses(),
                loadModules(),
                loadExams(),
                loadPayments()
            ]);
        }

        async function loadUsers() {
            const academyId = localStorage.getItem('current_academy_id');
            if (!academyId) return;

            const { data: members } = await supabase
                .from('academy_members')
                .select('user_id, role')
                .eq('academy_id', academyId);

            if (!members?.length) return;

            const userIds = members.map(m => m.user_id);
            const { data: profiles } = await supabase
                .from('profiles')
                .select('*')
                .in('id', userIds);

            usersData = profiles?.map(profile => ({
                ...profile,
                role: members.find(m => m.user_id === profile.id)?.role || 'secretary'
            })) || [];
        }

        async function loadStudents() {
            studentsData = [];
        }

        async function loadCourses() {
            const { data } = await supabase.from('courses').select('*');
            coursesData = data || [];
        }

        async function loadModules() {
            const { data } = await supabase.from('modules').select('*');
            modulesData = data || [];
        }

        async function loadExams() {
            const { data } = await supabase.from('exams').select('*');
            examsData = data || [];
        }

        async function loadPayments() {
            const { data } = await supabase.from('payments').select('*');
            paymentsData = data || [];
        }

        // ============ Update Stats ============
        function updateStats() {
            document.getElementById('totalUsers').textContent = usersData.length;
            document.getElementById('totalStudents').textContent = studentsData.length;
            document.getElementById('totalCourses').textContent = coursesData.length;
            document.getElementById('totalModules').textContent = modulesData.length;
            document.getElementById('totalExams').textContent = examsData.length;
            
            const teachers = usersData.filter(u => u.role === 'teacher');
            document.getElementById('totalTeachers').textContent = teachers.length;
        }

        function updateFinancialStats() {
            const totalPaid = paymentsData.reduce((sum, p) => sum + (p.amount || 0), 0);
            const totalAmount = paymentsData.reduce((sum, p) => sum + (p.total_amount || 0), 0);
            const remaining = Math.max(0, totalAmount - totalPaid);

            document.getElementById('totalPaidAmount').textContent = `${Math.round(totalPaid).toLocaleString('ar-EG')} Ø¬Ù†ÙŠÙ‡`;
            document.getElementById('totalRemainingAmount').textContent = `${Math.round(remaining).toLocaleString('ar-EG')} Ø¬Ù†ÙŠÙ‡`;
            document.getElementById('totalFinancialAmount').textContent = `${Math.round(totalAmount).toLocaleString('ar-EG')} Ø¬Ù†ÙŠÙ‡`;
        }

        // ============ Users Table ============
        function renderUsersTable(filteredUsers = null) {
            const users = filteredUsers || usersData;
            const tbody = document.getElementById('usersTableBody');
            if (!tbody) return;

            if (!users.length) {
                tbody.innerHTML = '<tr><td colspan="7" class="no-data"><i class="fas fa-users-slash"></i><br>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</td></tr>';
                return;
            }

            tbody.innerHTML = users.map(user => `
                <tr>
                    <td>${user.full_name || '-'}</td>
                    <td>${user.email || '-'}</td>
                    <td>${user.phone || '-'}</td>
                    <td>${user.specialty || '-'}</td>
                    <td>${translateRole(user.role)}</td>
                    <td>${new Date(user.created_at).toLocaleDateString('ar-EG')}</td>
                    <td class="user-actions">
                        <button class="action-btn edit-btn" onclick="editUser('${user.id}')">
                            <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„
                        </button>
                        <button class="action-btn" style="background: var(--warning);" onclick="resetPassword('${user.id}', '${user.email}')">
                            <i class="fas fa-key"></i> ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                        </button>
                        <button class="action-btn delete-btn" onclick="deleteUser('${user.id}')">
                            <i class="fas fa-trash"></i> Ø­Ø°Ù
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function translateRole(role) {
            const roles = { 'admin': 'Ù…Ø¯ÙŠØ±', 'teacher': 'Ù…Ø¹Ù„Ù…', 'secretary': 'Ø³ÙƒØ±ØªÙŠØ±' };
            return roles[role] || role;
        }

        function filterUsers() {
            const search = document.getElementById('userSearchInput')?.value.toLowerCase() || '';
            const role = document.getElementById('userRoleFilter')?.value || '';

            const filtered = usersData.filter(user => {
                const matchSearch = !search || 
                    user.full_name?.toLowerCase().includes(search) ||
                    user.email?.toLowerCase().includes(search);
                const matchRole = !role || user.role === role;
                return matchSearch && matchRole;
            });

            renderUsersTable(filtered);
        }

        // ============ User Management ============
        function showAddUserModal() {
            document.getElementById('addUserModal').style.display = 'flex';
        }

        function closeAddUserModal() {
            document.getElementById('addUserModal').style.display = 'none';
            document.getElementById('addUserForm').reset();
            document.getElementById('addUserStatus').className = 'status-message';
        }

        document.getElementById('addUserForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            const status = document.getElementById('addUserStatus');
            
            const fullName = document.getElementById('addFullName').value.trim();
            const email = document.getElementById('addEmail').value.trim().toLowerCase();
            const password = document.getElementById('addPassword').value;
            const phone = document.getElementById('addPhone').value.trim();
            const specialty = document.getElementById('addSpecialty').value.trim();
            const role = document.getElementById('addRole').value;

            try {
                status.textContent = 'Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨...';
                status.className = 'status-message info';

                const { data: authData, error: authError } = await supabase.auth.signUp({
                    email,
                    password,
                    options: { data: { full_name: fullName, role } }
                });

                if (authError) throw authError;
                if (!authData.user) throw new Error('ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');

                await supabase.from('profiles').upsert({
                    id: authData.user.id,
                    full_name: fullName,
                    email,
                    phone: phone || null,
                    specialty: specialty || null,
                    role,
                    academy_id: currentAcademyId
                });

                await supabase.from('academy_members').upsert({
                    user_id: authData.user.id,
                    academy_id: currentAcademyId,
                    role
                });

                status.textContent = 'âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­!';
                status.className = 'status-message success';

                await loadUsers();
                renderUsersTable();
                updateStats();

                setTimeout(closeAddUserModal, 2000);
            } catch (error) {
                status.textContent = `âŒ Ø®Ø·Ø£: ${error.message}`;
                status.className = 'status-message error';
            }
        });

        async function resetPassword(userId, userEmail) {
            try {
                const { error } = await supabase.auth.resetPasswordForEmail(userEmail, {
                    redirectTo: `${window.location.origin}/update-password.html`
                });
                if (error) throw error;
                alert('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ');
            } catch (error) {
                alert(`âŒ ${error.message}`);
            }
        }

        async function deleteUser(userId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ')) return;
            
            try {
                await supabase.from('academy_members').delete().eq('user_id', userId);
                await loadUsers();
                renderUsersTable();
                alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
            } catch (error) {
                alert('ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            }
        }

        async function editUser(userId) {
            try {
                const user = usersData.find(u => u.id === userId);
                if (!user) throw new Error('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');

                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.id = 'editUserModal';
                modal.style.display = 'flex';
                
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
                            <button class="close-btn" onclick="closeEditModal()">Ã—</button>
                        </div>
                        <form id="editUserForm">
                            <div class="form-group">
                                <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                                <input type="text" id="editFullName" value="${user.full_name || ''}" required>
                            </div>
                            <div class="form-group">
                                <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                                <input type="email" id="editEmail" value="${user.email || ''}" required>
                            </div>
                            <div class="form-group">
                                <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                                <input type="tel" id="editPhone" value="${user.phone || ''}">
                            </div>
                            <div class="form-group">
                                <label>Ø§Ù„ØªØ®ØµØµ</label>
                                <input type="text" id="editSpecialty" value="${user.specialty || ''}">
                            </div>
                            <div class="form-group">
                                <label>Ø§Ù„Ø¯ÙˆØ±</label>
                                <select id="editRole" required>
                                    <option value="admin" ${user.role === 'admin' ? 'selected' : ''}>Ù…Ø¯ÙŠØ±</option>
                                    <option value="teacher" ${user.role === 'teacher' ? 'selected' : ''}>Ù…Ø¹Ù„Ù…</option>
                                    <option value="secretary" ${user.role === 'secretary' ? 'selected' : ''}>Ø³ÙƒØ±ØªÙŠØ±</option>
                                </select>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="submit-btn">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                                <button type="button" class="cancel-btn" onclick="closeEditModal()">Ø¥Ù„ØºØ§Ø¡</button>
                            </div>
                        </form>
                        <div id="editUserStatus" class="status-message"></div>
                    </div>
                `;
                
                document.body.appendChild(modal);

                document.getElementById('editUserForm').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const status = document.getElementById('editUserStatus');
                    
                    try {
                        status.textContent = 'Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª...';
                        status.className = 'status-message info';

                        const fullName = document.getElementById('editFullName').value.trim();
                        const email = document.getElementById('editEmail').value.trim();
                        const phone = document.getElementById('editPhone').value.trim();
                        const specialty = document.getElementById('editSpecialty').value.trim();
                        const role = document.getElementById('editRole').value;

                        await supabase
                            .from('profiles')
                            .update({
                                full_name: fullName,
                                email: email,
                                phone: phone || null,
                                specialty: specialty || null
                            })
                            .eq('id', userId);

                        await supabase
                            .from('academy_members')
                            .update({ role: role })
                            .eq('user_id', userId)
                            .eq('academy_id', currentAcademyId);

                        status.textContent = 'âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­';
                        status.className = 'status-message success';

                        await loadUsers();
                        renderUsersTable();
                        updateStats();

                        setTimeout(closeEditModal, 1500);
                    } catch (error) {
                        status.textContent = `âŒ Ø®Ø·Ø£: ${error.message}`;
                        status.className = 'status-message error';
                    }
                });
            } catch (error) {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            }
        }

        function closeEditModal() {
            const modal = document.getElementById('editUserModal');
            if (modal) modal.remove();
        }

        function toggleActionsColumn() {
            actionsVisible = !actionsVisible;
            const container = document.querySelector('.users-table-container');
            const text = document.getElementById('toggleActionsText');
            
            if (actionsVisible) {
                container?.classList.remove('actions-hidden');
                if (text) text.textContent = 'Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª';
            } else {
                container?.classList.add('actions-hidden');
                if (text) text.textContent = 'Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª';
            }
        }

        // ============ Treasury Functions ============
        async function loadTreasury() {
            try {
                const academyId = localStorage.getItem('current_academy_id');
                if (!academyId) return;

                const { data: treasuryList } = await supabase
                    .from('treasury')
                    .select('*')
                    .eq('academy_id', academyId)
                    .order('created_at', { ascending: false })
                    .limit(1);

                adminTreasuryData = treasuryList?.[0] || { balance: 0, total_deposited: 0, total_withdrawn: 0 };
                
                document.getElementById('adminTreasuryBalance').textContent = formatCurrency(adminTreasuryData.balance);
                document.getElementById('adminTreasuryDeposited').textContent = formatCurrency(adminTreasuryData.total_deposited);
                document.getElementById('adminTreasuryWithdrawn').textContent = formatCurrency(adminTreasuryData.total_withdrawn);

                await loadAdminTreasuryTransactions();
            } catch (error) {
                console.error('Error loading treasury:', error);
            }
        }

        async function loadAdminTreasuryTransactions() {
            const academyId = localStorage.getItem('current_academy_id');
            const { data } = await supabase
                .from('treasury_transactions')
                .select('*')
                .eq('academy_id', academyId)
                .order('created_at', { ascending: false })
                .limit(100);

            adminTreasuryTransactions = data || [];
            renderAdminTreasuryTransactions();
        }

        function renderAdminTreasuryTransactions(filter = '') {
            const tbody = document.getElementById('adminTreasuryTransactionsBody');
            if (!tbody) return;

            let filtered = filter ? adminTreasuryTransactions.filter(t => t.transaction_type === filter) : adminTreasuryTransactions;

            if (!filtered.length) {
                tbody.innerHTML = '<tr><td colspan="5" class="no-data"><i class="fas fa-receipt"></i><br>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª</td></tr>';
                return;
            }

            tbody.innerHTML = filtered.map(t => {
                const date = new Date(t.created_at).toLocaleDateString('ar-EG');
                const type = t.transaction_type === 'deposit' ? 'Ø¥ÙŠØ¯Ø§Ø¹' : 'Ø³Ø­Ø¨';
                const color = t.transaction_type === 'deposit' ? 'var(--success)' : 'var(--danger)';
                const sign = t.transaction_type === 'deposit' ? '+' : '-';
                
                return `
                    <tr>
                        <td>${date}</td>
                        <td><span style="color: ${color}; font-weight: 600;">${type}</span></td>
                        <td style="font-weight: 700; color: ${color};">${sign}${formatCurrency(t.amount)}</td>
                        <td>${t.description || '-'}</td>
                        <td>Ø§Ù„Ù…Ø¯ÙŠØ±</td>
                    </tr>
                `;
            }).join('');
        }

        function filterAdminTreasuryTransactions() {
            const filter = document.getElementById('adminTreasuryFilter')?.value || '';
            renderAdminTreasuryTransactions(filter);
        }

        function toggleTransactionsTable() {
            transactionsVisible = !transactionsVisible;
            const container = document.querySelector('#treasuryTab .users-table-container');
            const text = document.getElementById('toggleTransactionsText');
            
            if (transactionsVisible) {
                container?.classList.remove('transactions-hidden');
                if (text) text.textContent = 'Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø³Ø¬Ù„';
            } else {
                container?.classList.add('transactions-hidden');
                if (text) text.textContent = 'Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø³Ø¬Ù„';
            }
        }

        function showWithdrawModal() {
            document.getElementById('withdrawModal').style.display = 'flex';
        }

        function closeWithdrawModal() {
            document.getElementById('withdrawModal').style.display = 'none';
            document.getElementById('withdrawForm').reset();
        }

        document.getElementById('withdrawForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const description = document.getElementById('withdrawDescription').value || 'Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø®Ø²ÙŠÙ†Ø©';
            const status = document.getElementById('withdrawStatus');

            try {
                const { data: treasury } = await supabase
                    .from('treasury')
                    .select('*')
                    .eq('academy_id', currentAcademyId)
                    .single();

                if (!treasury || treasury.balance < amount) {
                    throw new Error('Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ');
                }

                await supabase.from('treasury').update({
                    balance: treasury.balance - amount,
                    total_withdrawn: treasury.total_withdrawn + amount
                }).eq('id', treasury.id);

                await supabase.from('treasury_transactions').insert({
                    treasury_id: treasury.id,
                    academy_id: currentAcademyId,
                    transaction_type: 'withdrawal',
                    amount,
                    description,
                    created_by: localStorage.getItem('user_id')
                });

                status.textContent = 'âœ… ØªÙ… Ø§Ù„Ø³Ø­Ø¨ Ø¨Ù†Ø¬Ø§Ø­';
                status.className = 'status-message success';

                setTimeout(() => {
                    loadTreasury();
                    closeWithdrawModal();
                }, 1500);
            } catch (error) {
                status.textContent = `âŒ Ø®Ø·Ø£: ${error.message}`;
                status.className = 'status-message error';
            }
        });

        function formatCurrency(value) {
            return new Intl.NumberFormat('ar-EG', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(value || 0) + ' Ø¬.Ù…';
        }

        // ============ Reports ============
        async function generateStudentReport() {
            const statusEl = document.getElementById('reportStatus');
            const previewEl = document.getElementById('reportPreview');
            
            try {
                statusEl.style.display = 'block';
                statusEl.className = 'status-message info';
                statusEl.textContent = 'â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨...';
                previewEl.style.display = 'none';

                const academyId = localStorage.getItem('current_academy_id');
                const { data: students } = await supabase
                    .from('students')
                    .select('*')
                    .eq('academy_id', academyId)
                    .order('created_at', { ascending: false });

                const { data: subscriptions } = await supabase
                    .from('subscriptions')
                    .select('student_id, course_id')
                    .eq('academy_id', academyId);

                let html = `
                    <div style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h2 style="color: #3b82f6; margin-bottom: 20px; text-align: center;">
                            <i class="fas fa-users"></i> ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø·Ù„Ø§Ø¨
                        </h2>
                        <div style="margin-bottom: 20px; padding: 15px; background: #f0f9ff; border-radius: 8px;">
                            <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨:</strong> ${students?.length || 0}</p>
                            <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±:</strong> ${new Date().toLocaleDateString('ar-EG')}</p>
                        </div>
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: #3b82f6; color: white;">
                                    <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">Ø§Ù„Ø§Ø³Ù…</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">Ø§Ù„Ø¨Ø±ÙŠØ¯</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">Ø§Ù„Ù‡Ø§ØªÙ</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                students?.forEach((student, index) => {
                    const studentSubs = subscriptions?.filter(s => s.student_id === student.id) || [];
                    const date = new Date(student.created_at).toLocaleDateString('ar-EG');
                    html += `
                        <tr style="background: ${index % 2 === 0 ? '#f9fafb' : 'white'};">
                            <td style="padding: 10px; border: 1px solid #ddd;">${student.full_name || '-'}</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">${student.email || '-'}</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">${student.phone || '-'}</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">${studentSubs.length}</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">${date}</td>
                        </tr>
                    `;
                });

                html += `
                            </tbody>
                        </table>
                        <div style="margin-top: 20px; text-align: center;">
                            <button onclick="window.print()" class="add-user-btn" style="background: #10b981;">
                                <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                            </button>
                        </div>
                    </div>
                `;

                previewEl.innerHTML = html;
                previewEl.style.display = 'block';
                statusEl.className = 'status-message success';
                statusEl.textContent = `âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­ - ${students?.length || 0} Ø·Ø§Ù„Ø¨`;

            } catch (error) {
                console.error('Error generating student report:', error);
                statusEl.className = 'status-message error';
                statusEl.textContent = 'âŒ Ø®Ø·Ø£: ' + error.message;
            }
        }

        async function generateFinancialReport() {
            const statusEl = document.getElementById('reportStatus');
            const previewEl = document.getElementById('reportPreview');
            
            try {
                statusEl.style.display = 'block';
                statusEl.className = 'status-message info';
                statusEl.textContent = 'â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©...';
                previewEl.style.display = 'none';

                const academyId = localStorage.getItem('current_academy_id');
                const { data: payments } = await supabase
                    .from('payments')
                    .select('*')
                    .eq('academy_id', academyId);

                const totalPaid = payments?.reduce((sum, p) => sum + (p.amount || 0), 0) || 0;
                const totalAmount = payments?.reduce((sum, p) => sum + (p.total_amount || 0), 0) || 0;
                const remaining = totalAmount - totalPaid;

                let html = `
                    <div style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h2 style="color: #10b981; margin-bottom: 20px; text-align: center;">
                            <i class="fas fa-money-bill-wave"></i> Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ
                        </h2>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px;">
                            <div style="padding: 20px; background: #f0fdf4; border-radius: 8px; border-left: 4px solid #10b981;">
                                <h3 style="margin: 0 0 10px 0; color: #10b981;">Ø§Ù„Ù…Ø¯ÙÙˆØ¹</h3>
                                <p style="font-size: 1.5rem; font-weight: bold; margin: 0;">${formatCurrency(totalPaid)}</p>
                            </div>
                            <div style="padding: 20px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
                                <h3 style="margin: 0 0 10px 0; color: #f59e0b;">Ø§Ù„Ù…ØªØ£Ø®Ø±</h3>
                                <p style="font-size: 1.5rem; font-weight: bold; margin: 0;">${formatCurrency(remaining)}</p>
                            </div>
                            <div style="padding: 20px; background: #eff6ff; border-radius: 8px; border-left: 4px solid #3b82f6;">
                                <h3 style="margin: 0 0 10px 0; color: #3b82f6;">Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</h3>
                                <p style="font-size: 1.5rem; font-weight: bold; margin: 0;">${formatCurrency(totalAmount)}</p>
                            </div>
                        </div>
                        <div style="margin-bottom: 20px; padding: 15px; background: #f0f9ff; border-radius: 8px;">
                            <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª:</strong> ${payments?.length || 0}</p>
                            <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±:</strong> ${new Date().toLocaleDateString('ar-EG')}</p>
                        </div>
                        <div style="margin-top: 20px; text-align: center;">
                            <button onclick="window.print()" class="add-user-btn" style="background: #10b981;">
                                <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                            </button>
                        </div>
                    </div>
                `;

                previewEl.innerHTML = html;
                previewEl.style.display = 'block';
                statusEl.className = 'status-message success';
                statusEl.textContent = 'âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ Ø¨Ù†Ø¬Ø§Ø­';

            } catch (error) {
                console.error('Error generating financial report:', error);
                statusEl.className = 'status-message error';
                statusEl.textContent = 'âŒ Ø®Ø·Ø£: ' + error.message;
            }
        }

        async function generatePaymentReport() {
            const statusEl = document.getElementById('reportStatus');
            const previewEl = document.getElementById('reportPreview');
            
            try {
                statusEl.style.display = 'block';
                statusEl.className = 'status-message info';
                statusEl.textContent = 'â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹Ø§Øª...';
                previewEl.style.display = 'none';

                const academyId = localStorage.getItem('current_academy_id');
                const { data: payments } = await supabase
                    .from('payments')
                    .select('*')
                    .eq('academy_id', academyId)
                    .order('payment_date', { ascending: false })
                    .limit(100);

                const { data: students } = await supabase
                    .from('students')
                    .select('id, full_name')
                    .eq('academy_id', academyId);

                const { data: courses } = await supabase
                    .from('courses')
                    .select('id, name')
                    .eq('academy_id', academyId);

                let html = `
                    <div style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h2 style="color: #f59e0b; margin-bottom: 20px; text-align: center;">
                            <i class="fas fa-credit-card"></i> ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¯ÙØ¹Ø§Øª
                        </h2>
                        <div style="margin-bottom: 20px; padding: 15px; background: #fef3c7; border-radius: 8px;">
                            <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙØ¹Ø§Øª:</strong> ${payments?.length || 0}</p>
                            <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº:</strong> ${formatCurrency(payments?.reduce((sum, p) => sum + (p.amount || 0), 0) || 0)}</p>
                            <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±:</strong> ${new Date().toLocaleDateString('ar-EG')}</p>
                        </div>
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: #f59e0b; color: white;">
                                    <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">Ø§Ù„ÙƒÙˆØ±Ø³</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                payments?.forEach((payment, index) => {
                    const student = students?.find(s => s.id === payment.student_id);
                    const course = courses?.find(c => c.id === payment.course_id);
                    const date = new Date(payment.payment_date || payment.created_at).toLocaleDateString('ar-EG');
                    const statusColor = payment.status === 'paid' ? '#10b981' : '#f59e0b';
                    const statusText = payment.status === 'paid' ? 'Ù…Ø¯ÙÙˆØ¹' : 'Ù…ØªØ£Ø®Ø±';
                    
                    html += `
                        <tr style="background: ${index % 2 === 0 ? '#f9fafb' : 'white'};">
                            <td style="padding: 10px; border: 1px solid #ddd;">${student?.full_name || '-'}</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">${course?.name || '-'}</td>
                            <td style="padding: 10px; border: 1px solid #ddd; font-weight: bold;">${formatCurrency(payment.amount || 0)}</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">${payment.payment_method || '-'}</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">${date}</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">
                                <span style="color: ${statusColor}; font-weight: bold;">${statusText}</span>
                            </td>
                        </tr>
                    `;
                });

                html += `
                            </tbody>
                        </table>
                        <div style="margin-top: 20px; text-align: center;">
                            <button onclick="window.print()" class="add-user-btn" style="background: #f59e0b;">
                                <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                            </button>
                        </div>
                    </div>
                `;

                previewEl.innerHTML = html;
                previewEl.style.display = 'block';
                statusEl.className = 'status-message success';
                statusEl.textContent = `âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­ - ${payments?.length || 0} Ø¯ÙØ¹Ø©`;

            } catch (error) {
                console.error('Error generating payment report:', error);
                statusEl.className = 'status-message error';
                statusEl.textContent = 'âŒ Ø®Ø·Ø£: ' + error.message;
            }
        }

        async function generateAttendanceReport() {
            const statusEl = document.getElementById('reportStatus');
            const previewEl = document.getElementById('reportPreview');
            
            try {
                statusEl.style.display = 'block';
                statusEl.className = 'status-message info';
                statusEl.textContent = 'â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±...';
                previewEl.style.display = 'none';

                const academyId = localStorage.getItem('current_academy_id');
                
                let attendanceData = [];
                const { data: attendances1, error: error1 } = await supabase
                    .from('attendances')
                    .select('*')
                    .eq('academy_id', academyId)
                    .order('attendance_date', { ascending: false });

                if (error1 && error1.code === '42P01') {
                    const { data: attendances2 } = await supabase
                        .from('attendance')
                        .select('*')
                        .eq('academy_id', academyId);
                    attendanceData = attendances2 || [];
                } else {
                    attendanceData = attendances1 || [];
                }

                const { data: students } = await supabase
                    .from('students')
                    .select('id, full_name')
                    .eq('academy_id', academyId);

                const { data: courses } = await supabase
                    .from('courses')
                    .select('id, name')
                    .eq('academy_id', academyId);

                const present = attendanceData.filter(a => a.status === 'present' || a.status === 'Ø­Ø§Ø¶Ø±').length;
                const absent = attendanceData.filter(a => a.status === 'absent' || a.status === 'ØºØ§Ø¦Ø¨').length;
                const total = attendanceData.length;

                let html = `
                    <div style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h2 style="color: #8b5cf6; margin-bottom: 20px; text-align: center;">
                            <i class="fas fa-calendar-check"></i> ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ±
                        </h2>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px;">
                            <div style="padding: 20px; background: #f0fdf4; border-radius: 8px; border-left: 4px solid #10b981;">
                                <h3 style="margin: 0 0 10px 0; color: #10b981;">Ø­Ø§Ø¶Ø±</h3>
                                <p style="font-size: 1.5rem; font-weight: bold; margin: 0;">${present}</p>
                            </div>
                            <div style="padding: 20px; background: #fef2f2; border-radius: 8px; border-left: 4px solid #ef4444;">
                                <h3 style="margin: 0 0 10px 0; color: #ef4444;">ØºØ§Ø¦Ø¨</h3>
                                <p style="font-size: 1.5rem; font-weight: bold; margin: 0;">${absent}</p>
                            </div>
                            <div style="padding: 20px; background: #eff6ff; border-radius: 8px; border-left: 4px solid #3b82f6;">
                                <h3 style="margin: 0 0 10px 0; color: #3b82f6;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</h3>
                                <p style="font-size: 1.5rem; font-weight: bold; margin: 0;">${total}</p>
                            </div>
                        </div>
                        <div style="margin-bottom: 20px; padding: 15px; background: #f5f3ff; border-radius: 8px;">
                            <p><strong>Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±:</strong> ${total > 0 ? ((present / total) * 100).toFixed(1) : 0}%</p>
                            <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±:</strong> ${new Date().toLocaleDateString('ar-EG')}</p>
                        </div>
                `;

                if (attendanceData.length > 0) {
                    html += `
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: #8b5cf6; color: white;">
                                    <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">Ø§Ù„ÙƒÙˆØ±Ø³</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;

                    attendanceData.slice(0, 50).forEach((attendance, index) => {
                        const student = students?.find(s => s.id === attendance.student_id);
                        const course = courses?.find(c => c.id === attendance.course_id);
                        const date = new Date(attendance.attendance_date || attendance.created_at).toLocaleDateString('ar-EG');
                        const isPresent = attendance.status === 'present' || attendance.status === 'Ø­Ø§Ø¶Ø±';
                        const statusColor = isPresent ? '#10b981' : '#ef4444';
                        const statusText = isPresent ? 'Ø­Ø§Ø¶Ø±' : 'ØºØ§Ø¦Ø¨';
                        
                        html += `
                            <tr style="background: ${index % 2 === 0 ? '#f9fafb' : 'white'};">
                                <td style="padding: 10px; border: 1px solid #ddd;">${student?.full_name || '-'}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${course?.name || '-'}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${date}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">
                                    <span style="color: ${statusColor}; font-weight: bold;">${statusText}</span>
                                </td>
                            </tr>
                        `;
                    });

                    html += `
                            </tbody>
                        </table>
                    `;
                } else {
                    html += `
                        <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            <i class="fas fa-calendar-times" style="font-size: 3rem; margin-bottom: 15px; display: block;"></i>
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø¶ÙˆØ± Ù…ØªØ§Ø­Ø©</p>
                        </div>
                    `;
                }

                html += `
                        <div style="margin-top: 20px; text-align: center;">
                            <button onclick="window.print()" class="add-user-btn" style="background: #8b5cf6;">
                                <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                            </button>
                        </div>
                    </div>
                `;

                previewEl.innerHTML = html;
                previewEl.style.display = 'block';
                statusEl.className = 'status-message success';
                statusEl.textContent = `âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­ - ${total} Ø³Ø¬Ù„ Ø­Ø¶ÙˆØ±`;

            } catch (error) {
                console.error('Error generating attendance report:', error);
                statusEl.className = 'status-message error';
                statusEl.textContent = 'âŒ Ø®Ø·Ø£: ' + error.message;
            }
        }

        // ============ Advanced Search ============
        function advancedSearch() {
            document.getElementById('advancedSearchModal').style.display = 'flex';
        }

        function closeAdvancedSearchModal() {
            document.getElementById('advancedSearchModal').style.display = 'none';
        }

        function applyAdvancedSearch() {
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            const status = document.getElementById('statusFilter').value;
            
            // ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù‡Ù†Ø§
            console.log('Advanced search:', { dateFrom, dateTo, status });
            
            closeAdvancedSearchModal();
            showNotification('âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù…', 'success');
        }

        // ============ Export to Excel ============
        function exportReportToExcel() {
            const table = document.querySelector('#reportPreview table');
            if (table) {
                const wb = XLSX.utils.table_to_book(table);
                XLSX.writeFile(wb, `ØªÙ‚Ø±ÙŠØ±-${new Date().toISOString().split('T')[0]}.xlsx`);
                showNotification('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¥Ù„Ù‰ Excel', 'success');
            } else {
                showNotification('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙ‚Ø±ÙŠØ± Ù„ØªØµØ¯ÙŠØ±Ù‡', 'warning');
            }
        }

        // ============ Backup Database ============
        async function backupDatabase() {
            try {
                showNotification('â³ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©...', 'info');
                
                const tables = ['profiles', 'students', 'courses', 'payments', 'exams'];
                const backup = {};
                
                for (const table of tables) {
                    const { data } = await supabase.from(table).select('*');
                    backup[table] = data;
                }
                
                const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                showNotification('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } catch (error) {
                showNotification(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ: ${error.message}`, 'error');
            }
        }

        // ============ Real-time Notifications ============
        function setupRealtimeNotifications() {
            const channel = supabase
                .channel('notifications')
                .on(
                    'postgres_changes',
                    {
                        event: 'INSERT',
                        schema: 'public',
                        table: 'notifications'
                    },
                    (payload) => {
                        showNotification(payload.new.message, 'info');
                    }
                )
                .subscribe();
        }

        // ============ Settings ============
        async function loadAdminProfile() {
            const { data: { user } } = await supabase.auth.getUser();
            if (user) {
                document.getElementById('profileFullName').value = user.user_metadata?.full_name || 'Ø§Ù„Ù…Ø¯ÙŠØ±';
                document.getElementById('profileEmail').value = user.email || '';
                document.getElementById('profileRole').value = 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…';
                document.getElementById('userName').textContent = user.user_metadata?.full_name || 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…';
            }
        }

        function toggleDarkMode() {
            const isDarkMode = document.getElementById('darkModeToggle').checked;
            if (isDarkMode) {
                document.body.style.background = '#1f2937';
                document.querySelectorAll('.content-section').forEach(el => {
                    el.style.background = '#374151';
                    el.style.color = '#f3f4f6';
                });
                document.querySelectorAll('.users-table').forEach(el => {
                    el.style.background = '#374151';
                });
                document.querySelectorAll('.users-table tbody tr').forEach(el => {
                    el.style.background = '#374151';
                });
                localStorage.setItem('darkMode', 'true');
            } else {
                document.body.style.background = '#f9fafb';
                document.querySelectorAll('.content-section').forEach(el => {
                    el.style.background = '#ffffff';
                    el.style.color = '#111827';
                });
                document.querySelectorAll('.users-table').forEach(el => {
                    el.style.background = '#ffffff';
                });
                document.querySelectorAll('.users-table tbody tr').forEach(el => {
                    el.style.background = '#ffffff';
                });
                localStorage.setItem('darkMode', 'false');
            }
        }

        function showChangePasswordModal() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'changePasswordModal';
            modal.style.display = 'flex';
            
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>ğŸ”’ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h3>
                        <button class="close-btn" onclick="closePasswordModal()">Ã—</button>
                    </div>
                    <form id="changePasswordForm">
                        <div class="form-group">
                            <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                            <input type="password" id="newPassword" required minlength="6" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
                        </div>
                        <div class="form-group">
                            <label>ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                            <input type="password" id="confirmPassword" required minlength="6" placeholder="Ø£Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="submit-btn">ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
                            <button type="button" class="cancel-btn" onclick="closePasswordModal()">Ø¥Ù„ØºØ§Ø¡</button>
                        </div>
                    </form>
                    <div id="passwordStatus" class="status-message"></div>
                </div>
            `;
            
            document.body.appendChild(modal);

            document.getElementById('changePasswordForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const status = document.getElementById('passwordStatus');
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;

                if (newPassword !== confirmPassword) {
                    status.textContent = 'âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©';
                    status.className = 'status-message error';
                    return;
                }

                try {
                    status.textContent = 'Ø¬Ø§Ø±ÙŠ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±...';
                    status.className = 'status-message info';

                    const { error } = await supabase.auth.updateUser({
                        password: newPassword
                    });

                    if (error) throw error;

                    status.textContent = 'âœ… ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­';
                    status.className = 'status-message success';

                    setTimeout(closePasswordModal, 2000);
                } catch (error) {
                    status.textContent = `âŒ Ø®Ø·Ø£: ${error.message}`;
                    status.className = 'status-message error';
                }
            });
        }

        function toggleNotifications() {
            const enabled = document.getElementById('notificationToggle').checked;
            localStorage.setItem('notificationsEnabled', enabled);
            
            if (enabled) {
                showNotification('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª', 'success');
            } else {
                showNotification('âš ï¸ ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª', 'warning');
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: ${type === 'success' ? '#10b981' : type === 'warning' ? '#f59e0b' : type === 'error' ? '#ef4444' : '#3b82f6'};
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 10000;
                animation: slideInRight 0.3s ease-out;
                font-weight: 500;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-out';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Add animation styles
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        function logout() {
            localStorage.clear();
            window.location.href = 'index.html';
        }

        // ============ Hover Effects ============
        function addHoverEffects() {
            document.querySelectorAll('.stat-card').forEach(card => {
                card.addEventListener('mouseenter', () => {
                    card.style.transform = 'translateY(-5px) scale(1.02)';
                });
                card.addEventListener('mouseleave', () => {
                    card.style.transform = 'translateY(0) scale(1)';
                });
            });
        }

        // ============ Event Listeners ============
        document.getElementById('userSearchInput')?.addEventListener('input', filterUsers);
        document.getElementById('userRoleFilter')?.addEventListener('change', filterUsers);

        // ============ Initialize ============
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
            
            // Restore dark mode
            const darkMode = localStorage.getItem('darkMode');
            if (darkMode === 'true') {
                document.getElementById('darkModeToggle').checked = true;
                toggleDarkMode();
            }
            
            // Check notification settings
            const notifEnabled = localStorage.getItem('notificationsEnabled');
            if (notifEnabled === 'false') {
                document.getElementById('notificationToggle').checked = false;
            }
        });

        console.log('âœ… Admin Dashboard Loaded Successfully');
    </script>

</body>
</html>
